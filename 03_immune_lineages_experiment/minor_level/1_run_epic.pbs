#!/bin/bash
#######################
#PBS -N RUN-EPIC-MR
#PBS -l walltime=48:00:00
#PBS -l ncpus=4,mem=100Gb
#PBS -j oe
#PBS -m ae
#PBS -M <EMAIL>
#PBS -W umask=0027
#######################

module load R/4.0.2

# Set purity level
PUR_LVL="0.5"

# Set workin g directory
WORK_DIR="/working/lab_nicw/khoaT/deep_tme/tme_profiling/tme_benchmarking/deconvolution_benchmarking/2022_04_05_minor_immune_lineages"
cd $WORK_DIR

# Specify paths to data files
GENE_REF="${WORK_DIR}/data/epic/cbx_sig_matrix/reference_profiles.csv"
SIG_GENES_FILE="${WORK_DIR}/data/epic/cbx_sig_matrix/marker_gene_symbols.csv"
GENE_COUNTS_FILE="${WORK_DIR}/data/test/test_counts_${PUR_LVL}_pur_lvl.txt"

# Specify paths to output
OUT_DIR="${WORK_DIR}/data/epic/cbx_sig_matrix/results/${PUR_LVL}"
mkdir -p $OUT_DIR

# Specify path to execution scripts
SRC_DIR="/working/lab_nicw/khoaT/deep_tme/tme_profiling/tme_benchmarking/deconvolution_benchmarking/src"
SCRIPT_PATH="${SRC_DIR}/1_run_epic.R"

# EPIC parameter 
SIG_MATRIX="cbx"

# Run EPIC
Rscript ${SCRIPT_PATH} \
${GENE_REF} \
${GENE_COUNTS_FILE} \
${SIG_MATRIX} \
${SIG_GENES_FILE} \
${OUT_DIR} 
